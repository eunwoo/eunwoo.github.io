---
title: "single wire protocol"
---

STM32F743ZI는 SWPMI 기능 있음.

-O0  
==

```
 69                  static inline void delay_tenth_us(uint32_t tenth_us) {
                     delay_tenth_us:
0800071c: 0x000080b4   push    {r7}
0800071e: 0x000085b0   sub     sp, #20
08000720: 0x000000af   add     r7, sp, #0
08000722: 0x00007860   str     r0, [r7, #4]
 70                  	volatile uint32_t delay = tenth_us * 5;
08000724: 0x00007a68   ldr     r2, [r7, #4]
08000726: 0x00001346   mov     r3, r2
08000728: 0x00009b00   lsls    r3, r3, #2
0800072a: 0x00001344   add     r3, r2
0800072c: 0x0000fb60   str     r3, [r7, #12]
 71                  	while(delay--);
0800072e: 0x000000bf   nop     
08000730: 0x0000fb68   ldr     r3, [r7, #12]
08000732: 0x00005a1e   subs    r2, r3, #1
08000734: 0x0000fa60   str     r2, [r7, #12]
08000736: 0x0000002b   cmp     r3, #0
08000738: 0x0000fad1   bne.n   0x8000730 <delay_tenth_us+20>
 72                  }
0800073a: 0x000000bf   nop     
0800073c: 0x000000bf   nop     
0800073e: 0x00001437   adds    r7, #20
08000740: 0x0000bd46   mov     sp, r7
08000742: 0x5df8047b   ldr.w   r7, [sp], #4
08000746: 0x00007047   bx      lr
 ```
 
 -O3  
 ==
 최적화 옵션을 사용한 경우, 아래와 같이 굉장히 간결한 코드가 생성됨
 ```
 171                    delay_tenth_us(10);
0800086a: 0x00000299   ldr     r1, [sp, #8]
0800086c: 0x00004a1e   subs    r2, r1, #1
0800086e: 0x00000292   str     r2, [sp, #8]
08000870: 0x00000029   cmp     r1, #0
08000872: 0x0000fad1   bne.n   0x800086a <main+78>
 ```
 
